[build]
builder = "DOCKERFILE"

# Backend services
[[services]]
name = "backend"
source = "./backend"

[services.deploy]
healthcheckPath = "/health"
healthcheckTimeout = 100
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[services.variables]
OLLAMA_HOST = "http://localhost:11434"
MODEL_NAME = "tinyllama:latest"

# Frontend services
[[services]]
name = "frontend"
source = "./frontend"

[services.deploy]
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[services.variables]
BACKEND_URL = "${{services.backend.url}}"